<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dr.mapper.manager.ManagerMapper">

<!-- 1. 관리자 로그인-->
    <select id="managerLogin" resultType="ManagerSessionDTO">
        SELECT MANAGER_NAME
        FROM DR_MANAGER
        WHERE MANAGER_EMAIL = #{managerEmail} AND MANAGER_PW = #{managerPw}
    </select>

<!-- 2. 대시보드-->
    <select id="dashBoardInfo" resultType="DashBoardDTO">
        SELECT
                (SELECT COUNT(*) FROM DR_USER) AS userAll,
                (SELECT COUNT(*) FROM DR_SIREN) AS numAll,
                (SELECT COUNT(*) FROM DR_SIREN WHERE SIREN_TYPE = '게시글') AS boardNum,
                (SELECT COUNT(*) FROM DR_SIREN WHERE SIREN_TYPE = '레시피') AS recipeNum,
                (SELECT COUNT(*) FROM DR_SIREN WHERE SIREN_TYPE = '댓글') AS replyNum,
                TO_CHAR(SYSDATE, 'YYYY-MM-DD') AS today FROM DUAL
    </select>



    <select id="managerInfo" resultType="ManagerDTO">
        SELECT
        M.MANAGER_NAME AS managerName,
        M.MANAGER_EMAIL AS managerEmail,
        M.MANAGER_SORT AS managerSort
        FROM
        DR_MANAGER M
    </select>

<!-- 3. 회원관리-->
    <select id="manageUser" resultType="ManagerUserDTO">
        SELECT
            U.USER_NUMBER,
            U.USER_NICKNAME,
            U.USER_STATUS,
            U.USER_PHONE,
            U.USER_EMAIL
        FROM
            DR_USER U
        ORDER BY
            U.USER_NUMBER
    </select>

    <delete id="userOut" parameterType="Integer">
        DELETE
        FROM DR_USER U
        WHERE U.USER_NUMBER = #{userNumber}
    </delete>

    <update id="userPause" parameterType="Integer">
        UPDATE DR_USER
        SET USER_STATUS = '7일정지'
        WHERE USER_NUMBER = #{userNumber}
    </update>

<!-- 4. 게시판 관리-->
    <select id="showBoard" parameterType="ManagerBoardDTO">
        SELECT
            B.BOARD_NUMBER,
            B.BOARD_TITLE,
            U.USER_NICKNAME,
            COUNT(G.GOOD_NUMBER) AS goodCount,
            B.BOARD_WRITE_DATE,
            B.BOARD_TYPE
        FROM
            DR_BOARD B
                JOIN
            DR_USER U ON B.USER_NUMBER = U.USER_NUMBER
                LEFT JOIN
            DR_GOOD G ON B.BOARD_NUMBER = G.BOARD_NUMBER
        GROUP BY
            B.BOARD_NUMBER, B.BOARD_TITLE, U.USER_NICKNAME, B.BOARD_WRITE_DATE, B.BOARD_TYPE
        ORDER BY
            B.BOARD_WRITE_DATE DESC
    </select>

    <delete id="boardDelete" parameterType="Integer">
        DELETE
        FROM DR_BOARD B
        WHERE B.BOARD_NUMBER = #{boardNumber}
    </delete>

    <!-- 5. 레시피 관리-->
    <select id="showRecipe" parameterType="ManagerRecipeDTO">
        SELECT
            R.RECIPE_NUMBER,
            R.RECIPE_TITLE,
            U.USER_NICKNAME,
            COUNT(G.GOOD_NUMBER) AS goodCount,
            R.RECIPE_WRITE_DATE,
            R.RECIPE_TYPE
        FROM
            DR_RECIPE R
                JOIN
            DR_USER U ON R.USER_NUMBER = U.USER_NUMBER
                LEFT JOIN
            DR_GOOD G ON R.RECIPE_NUMBER = G.RECIPE_NUMBER
        GROUP BY
            R.RECIPE_NUMBER, R.RECIPE_TITLE, U.USER_NICKNAME, R.RECIPE_WRITE_DATE, R.RECIPE_TYPE
        ORDER BY
            R.RECIPE_WRITE_DATE DESC
    </select>

    <delete id="recipeDelete" parameterType="Integer">
        DELETE
        FROM DR_RECIPE R
        WHERE R.RECIPE_NUMBER = #{recipeNumber}
    </delete>



</mapper>
